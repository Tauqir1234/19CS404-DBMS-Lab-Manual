# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
-- Write a SQL query to List departments with names longer than the average length
```sql
SELECT 
    department_id AS depar,
    department_name
FROM Departments
WHERE LENGTH(department_name) > (
    SELECT AVG(LENGTH(department_name)) 
    FROM Departments
);
```

**Output:**

<img width="520" height="315" alt="image" src="https://github.com/user-attachments/assets/002226d6-c400-444a-91ba-dc0a453113dc" />


**Question 2**
---
-- From the following tables write a SQL query to find the order values greater than the average order value of 10th October 2012. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.


```sql
--
Select * from ORDERS
Where purch_amt>(
   Select Avg(purch_amt)
   from ORDERS
   Where ord_date='2012-10-10'
);
```

**Output:**

<img width="1202" height="379" alt="image" src="https://github.com/user-attachments/assets/99c62871-1bf8-4564-8a1b-92fb0f2ddc11" />


**Question 3**
---
-- Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.

```sql
--
 SELECT c.customer_id, c.cust_name, c.city, c.grade, c.salesman_id
FROM customer c
WHERE c.customer_id = (
    SELECT s.salesman_id 
    FROM salesman s 
    WHERE s.name = 'Mc Lyon'
) - 2001;
```

**Output:**

<img width="1219" height="221" alt="image" src="https://github.com/user-attachments/assets/d6963c66-3389-4e12-9c52-da702c8594b9" />


**Question 4**
---
-- Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.

```sql
--
SELECT g.student_name, g.grade
FROM GRADES g
WHERE g.grade = (
    SELECT MAX(grade)
    FROM GRADES g2
    WHERE g2.subject = g.subject
)
ORDER BY g.student_name ASC;
```

**Output:**

<img width="698" height="179" alt="image" src="https://github.com/user-attachments/assets/4d941117-79af-403d-8416-9e56c8b4bf59" />


**Question 5**
---
-- From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```sql
--
 SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
FROM orders o
JOIN salesman s ON o.salesman_id = s.salesman_id
WHERE s.city = 'New York';
```

**Output:**

<img width="1200" height="205" alt="image" src="https://github.com/user-attachments/assets/6f28fbcf-de6f-4da9-96d1-7f1923e259ed" />


**Question 6**
---
-- Write a SQL query to Retrieve the names of customers who have a phone number that is not shared with any other customer.

```sql
--
SELECT name
FROM customer
WHERE phone IN (
    SELECT phone
    FROM customer
    GROUP BY phone
    HAVING COUNT(*) = 1
);
```

**Output:**

<img width="390" height="227" alt="image" src="https://github.com/user-attachments/assets/067e49bb-2780-4e5e-958c-2acc4017232f" />


**Question 7**
---
-- Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.

```sql
--
SELECT g.student_id, g.student_name, g.subject, g.grade
FROM GRADES g
WHERE g.grade = (
    SELECT MIN(grade)
    FROM GRADES g2
    WHERE g2.subject = g.subject
)
ORDER BY g.student_id;
```

**Output:**

<img width="1218" height="178" alt="image" src="https://github.com/user-attachments/assets/d8197ef2-016c-4eec-8abc-7be5698f411a" />


**Question 8**
---
-- From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

```sql
--
SELECT s.salesman_id, s.name
FROM salesman s
WHERE s.salesman_id IN (
    SELECT salesman_id
    FROM customer
    GROUP BY salesman_id
    HAVING COUNT(*) > 1
);
```

**Output:**

<img width="537" height="158" alt="image" src="https://github.com/user-attachments/assets/33a87d06-962d-464a-aeb2-786786c87b0b" />


**Question 9**
---
-- From the following tables, write a SQL query to find all the orders issued by the salesman 'Paul Adam'. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

```sql
--
SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
FROM orders o
JOIN salesman s ON o.salesman_id = s.salesman_id
WHERE s.name = 'Paul Adam';
```

**Output:**

<img width="1208" height="132" alt="image" src="https://github.com/user-attachments/assets/6d68dabd-980b-4a1e-b678-b06a14ce1f10" />


**Question 10**
---
--Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is LESS than $2500.

```sql
--
SELECT ID, NAME, AGE, ADDRESS, SALARY
FROM CUSTOMERS
WHERE SALARY < 2500;
```

**Output:**

<img width="1167" height="183" alt="image" src="https://github.com/user-attachments/assets/bd48ca7a-4c44-401a-8378-e6928d7ab1bc" />


## MARKS:

<img width="1918" height="949" alt="image" src="https://github.com/user-attachments/assets/af507c61-f6f7-41cb-b390-de820936ee9e" />

## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
